<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Red Envelope's Secret: A Magical CNY Journey</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßß</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-image: url('images/background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #2c1810;
            position: relative;
        }

        body.quiz-mode {
            overflow: hidden;
            height: 100vh;
            padding: 10px;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(139, 0, 0, 0.75);
            z-index: 0;
        }

        .container {
            max-width: 810px;
            width: 100%;
            background: #FFF9E6;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .container.no-bg {
            background: transparent;
            box-shadow: none;
            padding: 0 10px;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .content {
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 2.5em;
            color: #8B0000;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255, 215, 0, 0.3);
            font-weight: 800;
        }

        .subtitle {
            text-align: center;
            font-style: italic;
            color: #DC143C;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .intro-text {
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.8;
            color: #4a3520;
        }

        .question-container {
            display: none;
            animation: fadeIn 0.5s;
            height: 100%;
        }

        .question-container.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: #8B0000;
            font-weight: 700;
        }

        .question-text {
            font-style: italic;
            margin-bottom: 15px;
            color: #4a3520;
            line-height: 1.4;
            font-size: 0.95em;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option {
            background: white;
            padding: 15px 15px 15px 15px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-size: 0.9em;
        }

        .option.selected {
            background: #FFF8DC;
            border-color: #DC143C;
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
        }

        .option:hover {
            background: #FFF8DC;
            border-color: #DC143C;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.2);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #FFE4B5;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #DC143C);
            border-radius: 10px;
            transition: width 0.5s;
        }

        .navigation-buttons {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 15px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #DC143C, #8B0000);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 0.95em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
            flex: 1;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .nav-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(220, 20, 60, 0.4);
        }

        .nav-btn.back-btn {
            background: linear-gradient(135deg, #8B7355, #6B5D4F);
        }

        .nav-btn.back-btn:not(:disabled):hover {
            box-shadow: 0 6px 16px rgba(139, 115, 85, 0.4);
        }

        .start-btn, .restart-btn {
            background: linear-gradient(135deg, #DC143C, #8B0000);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
        }

        .start-btn:hover, .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.4);
        }

        .results {
            display: none;
            height: 100%;
        }

        .results.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            animation: fadeIn 0.8s;
        }

        .result-header {
            text-align: center;
            margin-bottom: 8px;
            padding: 0 10px 5px 10px;
        }

        .result-label {
            font-size: 0.8em;
            color: #FFD700;
            margin-bottom: 2px;
        }

        .result-title {
            font-size: 1.5em;
            color: #FFD700;
            margin: 2px 0;
            font-weight: 800;
            line-height: 1.1;
        }

        .snack-name {
            font-size: 0.75em;
            color: #FFE5B4;
            font-style: italic;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .result-card {
            background: rgba(255, 249, 230, 0.95);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .result-card.no-bg {
            background: transparent;
            padding: 0;
            box-shadow: none;
        }

        .result-card.full-width {
            grid-column: 1 / -1;
        }

        .result-card h3 {
            color: #8B0000;
            font-size: 0.85em;
            margin-bottom: 6px;
            text-align: center;
            font-weight: 700;
        }

        .snack-image-container {
            width: 100%;
            height: 100%;
            min-height: 140px;
            border-radius: 8px;
            border: 3px solid #FFD700;
            background: #FFF;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .snack-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .snack-image-fallback {
            font-size: 3em;
            color: #DC143C;
        }

        .trait-pills {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .trait-pill {
            background: linear-gradient(135deg, #FFE5B4, #FFD700);
            padding: 5px 8px;
            border-radius: 12px;
            color: #8B0000;
            font-weight: 600;
            text-align: center;
            font-size: 0.65em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .description-text {
            line-height: 1.3;
            color: #2c1810;
            text-align: center;
            font-size: 0.7em;
            padding: 0 10px;
        }

        .compat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 6px;
        }

        .compat-group h4 {
            font-size: 0.75em;
            margin-bottom: 5px;
            text-align: center;
            font-weight: 700;
        }

        .friends-title {
            color: #2E7D32;
        }

        .strangers-title {
            color: #C62828;
        }

        .compat-names {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .compat-name {
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 6px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.6em;
            color: #2c1810;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .friends-name {
            border-left: 3px solid #4CAF50;
        }

        .strangers-name {
            border-left: 3px solid #F44336;
        }

        .explore-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #8B0000;
            border: none;
            padding: 10px 20px;
            font-size: 0.85em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
            margin: 10px auto;
            display: block;
        }

        .explore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 215, 0, 0.4);
        }

        .other-types-section {
            display: none;
            margin-top: 5px;
        }

        .other-types-section.active {
            display: block;
        }

        .cluster-group {
            margin-bottom: 8px;
        }

        .cluster-header {
            padding: 6px 8px;
            border-radius: 6px;
            margin-bottom: 4px;
            text-align: center;
        }

        .cluster-header.caregiving {
            background: linear-gradient(135deg, #FFE5E5, #FFB3BA);
        }

        .cluster-header.achievers {
            background: linear-gradient(135deg, #FFF4CC, #FFD966);
        }

        .cluster-header.creatives {
            background: linear-gradient(135deg, #E5F0FF, #B3D9FF);
        }

        .cluster-header.principled {
            background: linear-gradient(135deg, #F0E5FF, #D9B3FF);
        }

        .cluster-title {
            color: #8B0000;
            font-size: 0.85em;
            font-weight: 700;
            margin: 0 0 2px 0;
            line-height: 1.1;
        }

        .cluster-description {
            color: #6B5D4F;
            font-size: 0.68em;
            font-style: italic;
            margin: 0;
            line-height: 1.1;
        }

        .personality-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .personality-card {
            background: rgba(255, 249, 230, 0.95);
            border-radius: 6px;
            padding: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .personality-card.user-type {
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 0 25px rgba(255, 215, 0, 0.3);
            animation: glow 2s ease-in-out infinite;
        }

        .personality-card.user-type::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 215, 0, 0.3),
                transparent
            );
            animation: shimmer 3s infinite;
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 0 25px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 35px rgba(255, 215, 0, 0.5);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translate(-100%, -100%) rotate(45deg);
            }
            100% {
                transform: translate(100%, 100%) rotate(45deg);
            }
        }

        .personality-card-image {
            width: 35px;
            height: 35px;
            border-radius: 4px;
            border: 1.5px solid #FFD700;
            object-fit: cover;
            margin-bottom: 2px;
        }

        .personality-card-snack {
            color: #DC143C;
            font-size: 0.765em;
            font-weight: 700;
            margin: 0 0 1px 0;
            line-height: 1.05;
        }

        .personality-card-name {
            color: #8B0000;
            font-size: 0.646em;
            font-style: italic;
            margin: 0;
            line-height: 1.05;
        }

        @media (min-width: 769px) {
            .explore-btn {
                font-size: 1em;
                padding: 12px 24px;
                margin: 15px auto;
            }

            .other-types-section {
                margin-top: 10px;
            }

            .cluster-group {
                margin-bottom: 12px;
            }

            .cluster-header {
                padding: 10px 12px;
                margin-bottom: 6px;
            }

            .cluster-title {
                font-size: 0.85em;
                margin-bottom: 3px;
            }

            .cluster-description {
                font-size: 0.7em;
            }

            .personality-cards {
                gap: 8px;
            }

            .personality-card {
                padding: 8px;
            }

            .personality-card-image {
                width: 65px;
                height: 65px;
                border-width: 2px;
                margin-bottom: 4px;
            }

            .personality-card.user-type .personality-card-image {
                border-width: 3px;
            }

            .personality-card-snack {
                font-size: 0.7em;
                margin-bottom: 2px;
            }

            .personality-card-name {
                font-size: 0.6em;
            }
            .result-header {
                padding: 30px;
                margin-bottom: 30px;
            }

            .result-label {
                font-size: 1.2em;
                margin-bottom: 10px;
            }

            .result-title {
                font-size: 2.8em;
                margin: 10px 0 5px 0;
            }

            .snack-name {
                font-size: 1.3em;
            }

            .result-grid {
                gap: 20px;
                margin-top: 30px;
            }

            .result-card {
                padding: 25px;
                border-radius: 15px;
            }

            .result-card h3 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .snack-image-container {
                min-height: 300px;
                border-radius: 15px;
                border: 4px solid #FFD700;
            }

            .snack-image-fallback {
                font-size: 6em;
            }

            .trait-pills {
                gap: 12px;
            }

            .trait-pill {
                padding: 14px 20px;
                border-radius: 25px;
                font-size: 0.95em;
            }

            .description-text {
                font-size: 1em;
                line-height: 1.7;
            }

            .compat-grid {
                gap: 20px;
                margin-top: 15px;
            }

            .compat-group h4 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }

            .compat-names {
                gap: 10px;
            }

            .compat-name {
                padding: 12px 15px;
                border-radius: 10px;
                font-size: 0.95em;
            }

            .friends-name {
                border-left: 4px solid #4CAF50;
            }

            .strangers-name {
                border-left: 4px solid #F44336;
            }
        }



        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }
            
            .container {
                padding: 20px;
            }
            
            .option {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <div id="intro">
                <h1>üßß The Red Envelope's Secret üßß</h1>
                <p class="subtitle">A Magical Journey Home</p>
                <p class="intro-text">
                    Discover your Chinese New Year personality through a mystical adventure. 
                    As you prepare for the celebrations, visit family, and find your way home, 
                    the choices you make will reveal which traditional CNY snack matches your spirit.
                    <br><br>
                    Are you ready to unveil your destiny?
                </p>
                <button class="start-btn" onclick="startQuiz()">Begin Your Journey</button>
            </div>

            <div id="quiz" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div id="questionsContainer"></div>
            </div>

            <div id="results" class="results">
                <div class="result-header">
                    <p class="result-label">You Are...</p>
                    <h2 class="result-title" id="snackName"></h2>
                    <p class="snack-name" id="resultType"></p>
                </div>

                <div class="result-grid">
                    <!-- Left: Image (fills entire grid space) -->
                    <div class="result-card no-bg">
                        <div class="snack-image-container" id="snackImage"></div>
                    </div>

                    <!-- Right: Key Traits -->
                    <div class="result-card">
                        <h3>Key Traits</h3>
                        <div class="trait-pills" id="keyTraits"></div>
                    </div>

                    <!-- Full Width: Description -->
                    <div class="result-card full-width">
                        <h3>Your CNY Personality</h3>
                        <p class="description-text" id="description"></p>
                    </div>

                    <!-- Full Width: Compatibility -->
                    <div class="result-card full-width">
                        <h3>Compatibility</h3>
                        <div id="compatibility"></div>
                    </div>
                </div>

                <button class="explore-btn" onclick="toggleOtherTypes()">‚ú® Explore Other Personality Types</button>

                <div id="otherTypes" class="other-types-section"></div>
            </div>
        </div>
    </div>


    <script>
        const questions = [
            {
                id: 1,
                question: "Question 1: The Golden Morning",
                text: "You wake up on Chinese New Year Eve to find a glowing red envelope (red envelope) on your pillow that wasn't there last night. When you open it, golden light spills out. What do you do?",
                options: [
                    { text: "Carefully examine it to understand what's happening before touching anything", scores: { analyst: 2, protector: 1 } },
                    { text: "Immediately call your family to share this amazing discovery", scores: { nurturer: 2, harmonizer: 1 } },
                    { text: "Feel a deep sense of wonder and write down your emotions", scores: { individualist: 2, idealist: 1 } },
                    { text: "Be filled with delight and excitement at the adventure this might bring", scores: { adventurer: 2, entertainer: 1 } }
                ]
            },
            {
                id: 2,
                question: "Question 2: The Market's Call",
                text: "The red envelope whispers that you must visit the Chinese New Year bazaar in Chinatown. At the crowded market, you notice:",
                options: [
                    { text: "An elderly vendor struggling with heavy boxes ‚Äî you offer to help", scores: { nurturer: 2, harmonizer: 1 } },
                    { text: "The most popular stall with the longest queue ‚Äî that's where the best items must be", scores: { achiever: 2, catalyst: 1 } },
                    { text: "A hidden corner stall with unusual, handcrafted decorations no one else seems to notice", scores: { individualist: 2, innovator: 1 } },
                    { text: "The traditional calligrapher who's been in the same spot for 40 years", scores: { traditionalist: 2, protector: 1 } }
                ]
            },
            {
                id: 3,
                question: "Question 3: The Preparation Dilemma",
                text: "Back home, you realise the house still needs cleaning, food needs cooking, and decorations need hanging. You:",
                options: [
                    { text: "Create a detailed schedule and systematically work through each task", scores: { analyst: 2, achiever: 1 } },
                    { text: "Rally your family together and make it a fun group activity with music", scores: { entertainer: 2, catalyst: 1 } },
                    { text: "Focus on the most meaningful touches that will make guests feel welcomed", scores: { nurturer: 2, idealist: 1 } },
                    { text: "Do the essential traditional preparations your family has always done", scores: { traditionalist: 2, protector: 1 } }
                ]
            },
            {
                id: 4,
                question: "Question 4: The Magical Ingredient",
                text: "While cooking, you discover a glowing ingredient in your pantry you've never seen before. The red envelope pulses. You:",
                options: [
                    { text: "Research what it might be before using it", scores: { analyst: 2, protector: 1 } },
                    { text: "Trust your instincts and experiment ‚Äî cooking should be creative!", scores: { innovator: 2, adventurer: 1 } },
                    { text: "Ask your elders if they recognize it from old recipes", scores: { traditionalist: 2, harmonizer: 1 } },
                    { text: "Add it to your dish ‚Äî fortune favors the bold!", scores: { adventurer: 2, catalyst: 1 } }
                ]
            },
            {
                id: 5,
                question: "Question 5: The Family Reunion",
                text: "At your family gathering, chaos erupts. Two relatives start arguing over a grievance. The red envelope grows dim. You:",
                options: [
                    { text: "Step in gently to mediate and find common ground", scores: { harmonizer: 2, idealist: 1 } },
                    { text: "Distract everyone with games or entertainment to lighten the mood", scores: { entertainer: 2, catalyst: 1 } },
                    { text: "Listen to both sides to understand the deeper emotions involved", scores: { idealist: 2, nurturer: 1 } },
                    { text: "Suggest honoring tradition by letting elders speak and resolve it their way", scores: { traditionalist: 2, protector: 1 } }
                ]
            },
            {
                id: 6,
                question: "Question 6: The Midnight Test",
                text: "At midnight, the red envelope reveals a test: You can receive one blessing for the new year. Choose:",
                options: [
                    { text: "Success in your ambitions and recognition for your hard work", scores: { achiever: 2, catalyst: 1 } },
                    { text: "Deep, meaningful connections with those you love", scores: { idealist: 2, nurturer: 1 } },
                    { text: "Safety and security for your family", scores: { protector: 2, traditionalist: 1 } },
                    { text: "Freedom to explore new possibilities", scores: { adventurer: 2, innovator: 1 } }
                ]
            },
            {
                id: 7,
                question: "Question 7: The Ancestor's Message",
                text: "Your late grandmother appears in a dream that night, smiling. She shows you a memory. Which memory resonates most?",
                options: [
                    { text: "Her teaching you a traditional recipe, step by careful step", scores: { traditionalist: 2, analyst: 1 } },
                    { text: "Her laughing joyfully at a family gathering, surrounded by loved ones", scores: { entertainer: 2, harmonizer: 1 } },
                    { text: "Her quietly sitting with you, just being present without words", scores: { individualist: 2, idealist: 1 } },
                    { text: "Her telling you stories of her youth and adventures", scores: { adventurer: 2, innovator: 1 } }
                ]
            },
            {
                id: 8,
                question: "Question 8: The Reunion Dinner Speech",
                text: "You're unexpectedly asked to give a toast at dinner. You speak about:",
                options: [
                    { text: "Gratitude for family and the importance of cherishing each other", scores: { nurturer: 2, harmonizer: 1 } },
                    { text: "Exciting goals and dreams for the year ahead", scores: { achiever: 2, catalyst: 1 } },
                    { text: "Honoring ancestors and maintaining treasured traditions", scores: { traditionalist: 2, protector: 1 } },
                    { text: "The unique journey each person is on and celebrating individuality", scores: { individualist: 2, innovator: 1 } }
                ]
            },
            {
                id: 9,
                question: "Question 9: The Heirloom's Choice",
                text: "An elderly aunt offers you a precious family heirloom. During the exchange, the red envelope glows warmly. What moves you most about this moment?",
                options: [
                    { text: "The excitement of being chosen and recognized by your family", scores: { catalyst: 2, entertainer: 1 } },
                    { text: "The profound connection to your family's history and roots", scores: { idealist: 2, traditionalist: 1 } },
                    { text: "The responsibility and privilege of preserving something meaningful", scores: { protector: 2, analyst: 1 } },
                    { text: "The opportunity to honor your aunt's trust and make her happy", scores: { nurturer: 2, harmonizer: 1 } }
                ]
            },
            {
                id: 10,
                question: "Question 10: The Final Gift",
                text: "Home at last, the red envelope delivers its final magic ‚Äî it shows you what you brought to this year's celebration. What do you see yourself giving?",
                options: [
                    { text: "Warmth and emotional support that made others feel safe", scores: { nurturer: 2, harmonizer: 1, idealist: 1 } },
                    { text: "Energy and enthusiasm that made everything more fun", scores: { entertainer: 2, catalyst: 2, adventurer: 1 } },
                    { text: "Wisdom and careful planning that made everything run smoothly", scores: { analyst: 2, protector: 1, traditionalist: 1 } },
                    { text: "Creativity and fresh ideas that made things memorable", scores: { innovator: 2, individualist: 1, achiever: 1 } }
                ]
            }
        ];

        const personalityTypes = {
            harmonizer: {
                name: "The Harmonizer",
                snack: "Kueh Bangkit",
                snackDisplay: "A Kueh Bangkit",
                emoji: "‚òÅÔ∏è",
                image: "images/snacks/kueh-bangkit.png",
                traits: ["Peace-seeking", "Gentle", "Diplomatic", "Empathetic", "Conflict-avoidant"],
                description: "Like Kueh Bangkit that melts with delicate sweetness, you bring tranquility wherever you go. You smooth over conflicts at family gatherings, creating an atmosphere where everyone feels comfortable and heard.",
                friends: [
                    { type: "The Nurturer", reason: "Both prioritize others' wellbeing and create supportive environments" },
                    { type: "The Idealist", reason: "Share desire for authentic connections and peaceful resolution" }
                ],
                strangers: [
                    { type: "The Achiever", reason: "Harmonizer's conflict avoidance clashes with Achiever's competitive drive" },
                    { type: "The Entertainer", reason: "Entertainer's spotlight-seeking can overwhelm Harmonizer's quiet presence" }
                ]
            },
            achiever: {
                name: "The Achiever",
                snack: "Bak Kwa",
                snackDisplay: "A Bak Kwa",
                emoji: "üèÜ",
                image: "images/snacks/bak-kwa.png",
                traits: ["Ambitious", "Competitive", "Image-conscious", "Goal-oriented", "High-performing"],
                description: "You are the Bak Kwa of CNY ‚Äî premium, meticulously crafted, and always the centerpiece. You invest deeply in your goals and present your best self to the world, arriving with impressive gifts and coordinating everything perfectly.",
                friends: [
                    { type: "The Catalyst", reason: "Both energetic and goal-oriented, push each other forward" },
                    { type: "The Analyst", reason: "Analyst provides strategic thinking to support Achiever's ambitions" }
                ],
                strangers: [
                    { type: "The Harmonizer", reason: "Achiever's intensity disrupts Harmonizer's need for peace" },
                    { type: "The Adventurer", reason: "Adventurer's spontaneity conflicts with Achiever's planned success path" }
                ]
            },
            nurturer: {
                name: "The Nurturer",
                snack: "Pineapple Tarts",
                snackDisplay: "A Pineapple Tart",
                emoji: "ü§ó",
                image: "images/snacks/pineapple-tarts.png",
                traits: ["Caring", "Devoted", "Warm", "Selfless", "Supportive"],
                description: "Like Pineapple Tarts lovingly shaped by hand, you pour your heart into caring for others. You remember everyone's preferences, make extra portions, and ensure no one leaves feeling empty. Your warmth makes every gathering feel like home.",
                friends: [
                    { type: "The Harmonizer", reason: "Both create warm, supportive environments for others" },
                    { type: "The Protector", reason: "Share commitment to caring for and safeguarding loved ones" }
                ],
                strangers: [
                    { type: "The Individualist", reason: "Individualist's self-focus can seem selfish to service-oriented Nurturer" },
                    { type: "The Achiever", reason: "Nurturer may feel used when Achiever prioritizes goals over relationships" }
                ]
            },
            innovator: {
                name: "The Innovator",
                snack: "Kueh Lapis",
                snackDisplay: "A Kueh Lapis",
                emoji: "üí°",
                image: "images/snacks/kueh-lapis.png",
                traits: ["Creative", "Forward-thinking", "Complex", "Visionary", "Unconventional"],
                description: "You embody the intricate art of Kueh Lapis ‚Äî multi-layered and requiring creativity. You approach life with vision, always thinking several steps ahead. You suggest new CNY traditions and find innovative ways to celebrate while honoring the past.",
                friends: [
                    { type: "The Adventurer", reason: "Both thrive on novelty and trying new approaches" },
                    { type: "The Idealist", reason: "Share vision for how things could be better and different" }
                ],
                strangers: [
                    { type: "The Traditionalist", reason: "Innovator's constant change threatens Traditionalist's stability" },
                    { type: "The Protector", reason: "Protector sees Innovator's risk-taking as irresponsible" }
                ]
            },
            traditionalist: {
                name: "The Traditionalist",
                snack: "Almond Cookies",
                snackDisplay: "An Almond Cookie",
                emoji: "üìú",
                image: "images/snacks/almond-cookies.png",
                traits: ["Steadfast", "Respectful", "Principled", "Heritage-focused", "Reliable"],
                description: "Like Almond Cookies unchanged through generations, you are the keeper of heritage and tradition. You ensure proper rituals are observed, teach younger generations the significance of customs, and bring stability through time-honored practices.",
                friends: [
                    { type: "The Protector", reason: "Both value stability, loyalty, and proven methods" },
                    { type: "The Analyst", reason: "Analyst's methodical approach aligns with Traditionalist's systematic values" }
                ],
                strangers: [
                    { type: "The Innovator", reason: "Traditionalist resists Innovator's push for constant change" },
                    { type: "The Adventurer", reason: "Adventurer's impulsiveness conflicts with Traditionalist's need for structure" }
                ]
            },
            adventurer: {
                name: "The Adventurer",
                snack: "Prawn Rolls",
                snackDisplay: "A Prawn Roll",
                emoji: "üåü",
                image: "images/snacks/prawn-rolls.png",
                traits: ["Spontaneous", "Risk-taking", "Free-spirited", "Bold", "Experience-seeking"],
                description: "You're the fiery Prawn Roll ‚Äî bold, unexpected, and impossible to ignore. You bring excitement and spontaneity to every moment. You're the cousin who suggests impromptu road trips or tries daring combinations, inspiring others to step outside their comfort zones.",
                friends: [
                    { type: "The Innovator", reason: "Both embrace change and seek exciting experiences" },
                    { type: "The Entertainer", reason: "Share spontaneous energy and love of fun" }
                ],
                strangers: [
                    { type: "The Traditionalist", reason: "Adventurer's rule-breaking frustrates Traditionalist" },
                    { type: "The Analyst", reason: "Analyst's need to overthink dampens Adventurer's spontaneity" }
                ]
            },
            analyst: {
                name: "The Analyst",
                snack: "Arrowhead Chips",
                snackDisplay: "An Arrowhead Chip",
                emoji: "üîç",
                image: "images/snacks/arrowhead-chips.png",
                traits: ["Logical", "Observant", "Systematic", "Detail-oriented", "Rational"],
                description: "Like Arrowhead Chips sliced with mathematical precision, you bring order and careful consideration to every situation. You calculate optimal visiting times, notice when dishes run low, and can explain the historical origins of every CNY tradition.",
                friends: [
                    { type: "The Achiever", reason: "Analyst provides strategic depth to Achiever's ambition" },
                    { type: "The Traditionalist", reason: "Both appreciate systematic, proven approaches" }
                ],
                strangers: [
                    { type: "The Adventurer", reason: "Adventurer's impulsiveness seems reckless to careful Analyst" },
                    { type: "The Entertainer", reason: "Entertainer's emotional expressiveness overwhelms logical Analyst" }
                ]
            },
            idealist: {
                name: "The Idealist",
                snack: "Love Letters",
                snackDisplay: "A Love Letter",
                emoji: "üí´",
                image: "images/snacks/love-letters.png",
                traits: ["Principled", "Authentic", "Meaning-driven", "Philosophical", "Introspective"],
                description: "You are the Love Letters of CNY ‚Äî delicate and full of deeper meaning. You seek genuine meaning in traditions and relationships. You write heartfelt messages in red envelopes and create meaningful moments during celebrations.",
                friends: [
                    { type: "The Harmonizer", reason: "Share desire for authentic, meaningful connections" },
                    { type: "The Innovator", reason: "Both envision better possibilities and pursue meaningful change" }
                ],
                strangers: [
                    { type: "The Achiever", reason: "Idealist sees Achiever as superficial and image-obsessed" },
                    { type: "The Catalyst", reason: "Catalyst's relentless optimism can feel inauthentic to depth-seeking Idealist" }
                ]
            },
            entertainer: {
                name: "The Entertainer",
                snack: "Honeycomb Cookies",
                snackDisplay: "A Honeycomb Cookie",
                emoji: "üé≠",
                image: "images/snacks/honeycomb-cookies.png",
                traits: ["Charismatic", "Playful", "Expressive", "Attention-loving", "Fun-loving"],
                description: "Like mesmerizing Honeycomb Cookies with beautiful geometric patterns, you are visually captivating and impossible to resist. You're the life of every CNY gathering, turning mundane moments into memorable experiences through games, jokes, and infectious energy.",
                friends: [
                    { type: "The Adventurer", reason: "Both spontaneous and fun-loving, feed off each other's energy" },
                    { type: "The Catalyst", reason: "Share enthusiasm and ability to energize groups" }
                ],
                strangers: [
                    { type: "The Analyst", reason: "Analyst's serious demeanor dampens Entertainer's playful spirit" },
                    { type: "The Individualist", reason: "Individualist views Entertainer as shallow and attention-seeking" }
                ]
            },
            protector: {
                name: "The Protector",
                snack: "Nian Gao",
                snackDisplay: "A Nian Gao",
                emoji: "üõ°Ô∏è",
                image: "images/snacks/nian-gao.png",
                traits: ["Loyal", "Responsible", "Security-focused", "Dependable", "Cautious"],
                description: "You are the Nian Gao of CNY ‚Äî symbolizing protection and prosperity for loved ones. You work tirelessly to ensure your family's wellbeing and security. You check on elderly relatives, ensure children's safety, and keep watchful eyes on everyone's welfare.",
                friends: [
                    { type: "The Traditionalist", reason: "Both value stability, loyalty, and time-tested ways" },
                    { type: "The Nurturer", reason: "Share commitment to caring for and supporting others" }
                ],
                strangers: [
                    { type: "The Innovator", reason: "Protector sees Innovator's changes as threatening to security" },
                    { type: "The Individualist", reason: "Individualist's unconventional choices worry security-focused Protector" }
                ]
            },
            individualist: {
                name: "The Individualist",
                snack: "Sugee Cookies",
                snackDisplay: "A Sugee Cookie",
                emoji: "üé®",
                image: "images/snacks/sugee-cookies.png",
                traits: ["Introspective", "Non-conformist", "Emotionally deep", "Unique", "Self-aware"],
                description: "Like Sugee Cookies with their distinctive texture that sets them apart, you embrace your uniqueness unapologetically. You show up in unconventional attire, question traditions thoughtfully, and express yourself authentically. Your depth and individuality add richness to every gathering.",
                friends: [
                    { type: "The Idealist", reason: "Both seek authenticity and depth in life and relationships" },
                    { type: "The Innovator", reason: "Appreciate each other's unique perspectives and creative expression" }
                ],
                strangers: [
                    { type: "The Entertainer", reason: "Entertainer's superficial charm irritates depth-seeking Individualist" },
                    { type: "The Nurturer", reason: "Nurturer's focus on others can make Individualist feel misunderstood" }
                ]
            },
            catalyst: {
                name: "The Catalyst",
                snack: "White Rabbit Candies",
                snackDisplay: "A White Rabbit Candy",
                emoji: "‚ú®",
                image: "images/snacks/white-rabbit-candies.png",
                traits: ["Optimistic", "Inspiring", "Enthusiastic", "Energetic", "Motivating"],
                description: "You are White Rabbit Candies ‚Äî bringing instant joy and infectious optimism wherever you go. You have the magical ability to lift spirits and inspire hope. You get everyone excited about traditions and spread contagious enthusiasm.",
                friends: [
                    { type: "The Achiever", reason: "Both energetic and forward-moving, motivate each other" },
                    { type: "The Entertainer", reason: "Share infectious enthusiasm and ability to inspire groups" }
                ],
                strangers: [
                    { type: "The Individualist", reason: "Individualist finds Catalyst's positivity dismissive of complexity" },
                    { type: "The Idealist", reason: "Idealist may see Catalyst's optimism as naive or superficial" }
                ]
            }
        };

        // Personality clusters for grouping compatible types
        const personalityClusters = {
            caregiving: {
                name: "The Caregiving Circle",
                description: "Focused on supporting others and creating harmony",
                types: ["harmonizer", "nurturer", "protector"]
            },
            achievers: {
                name: "The Achievement Squad",
                description: "Driven by goals, progress, and making an impact",
                types: ["achiever", "catalyst", "analyst"]
            },
            creatives: {
                name: "The Creative Collective",
                description: "Value originality, self-expression, and innovation",
                types: ["innovator", "individualist", "entertainer"]
            },
            principled: {
                name: "The Principled Path",
                description: "Guided by values, meaning, and deeper purpose",
                types: ["traditionalist", "idealist", "adventurer"]
            }
        };

        let currentQuestion = 0;
        let answers = {}; // Track selected answers for each question
        let scores = {
            harmonizer: 0,
            achiever: 0,
            nurturer: 0,
            innovator: 0,
            traditionalist: 0,
            adventurer: 0,
            analyst: 0,
            idealist: 0,
            entertainer: 0,
            protector: 0,
            individualist: 0,
            catalyst: 0
        };

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Randomize options for all questions
        function randomizeQuestions() {
            questions.forEach(question => {
                question.options = shuffleArray(question.options);
            });
        }

        function startQuiz() {
            randomizeQuestions(); // Randomize option order
            document.getElementById('intro').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';
            document.body.classList.add('quiz-mode');
            renderQuestion();
        }

        function renderQuestion() {
            const container = document.getElementById('questionsContainer');
            const question = questions[currentQuestion];
            
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const selectedAnswer = answers[currentQuestion];

            container.innerHTML = `
                <div class="question-container active">
                    <div class="question">${question.question}</div>
                    <div class="question-text">${question.text}</div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option ${selectedAnswer === index ? 'selected' : ''}" onclick="selectOption(${index})">
                                ${option.text}
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation-buttons">
                        <button class="nav-btn back-btn" onclick="goBack()" ${currentQuestion === 0 ? 'disabled' : ''}>
                            ‚Üê Back
                        </button>
                        <button class="nav-btn" onclick="goNext()" ${selectedAnswer === undefined ? 'disabled' : ''}>
                            ${currentQuestion === questions.length - 1 ? 'See Results ‚Üí' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;
        }

        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            
            // Update selected state without re-rendering entire question
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
            
            // Enable the Next button
            const nextBtn = document.querySelector('.navigation-buttons .nav-btn:last-child');
            nextBtn.disabled = false;
        }

        function goBack() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function goNext() {
            if (answers[currentQuestion] !== undefined) {
                if (currentQuestion < questions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                } else {
                    calculateScoresAndShowResults();
                }
            }
        }

        function calculateScoresAndShowResults() {
            // Reset scores
            for (let type in scores) {
                scores[type] = 0;
            }

            // Calculate scores based on all answers
            for (let questionIndex in answers) {
                const question = questions[questionIndex];
                const selectedOptionIndex = answers[questionIndex];
                const selectedOption = question.options[selectedOptionIndex];

                for (let type in selectedOption.scores) {
                    scores[type] += selectedOption.scores[type];
                }
            }

            showResults();
        }

        function showResults() {
            document.getElementById('quiz').style.display = 'none';
            
            // Remove cream background for results page
            document.querySelector('.container').classList.add('no-bg');
            // Keep body in no-scroll mode (quiz-mode already applied)
            
            // Find highest scoring personality type
            let maxScore = 0;
            let resultType = '';
            
            for (let type in scores) {
                if (scores[type] > maxScore) {
                    maxScore = scores[type];
                    resultType = type;
                }
            }

            const personality = personalityTypes[resultType];
            
            document.getElementById('resultType').textContent = personality.name;
            document.getElementById('snackName').textContent = personality.snackDisplay;
            
            // Create image element with fallback
            const imageContainer = document.getElementById('snackImage');
            imageContainer.innerHTML = `
                <img src="${personality.image}" 
                     alt="${personality.snack}" 
                     class="snack-image"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="snack-image-fallback" style="display: none;">${personality.emoji}</div>
            `;
            
            // Key traits as pills
            const traitsHtml = personality.traits.map(trait => 
                `<div class="trait-pill">${trait}</div>`
            ).join('');
            document.getElementById('keyTraits').innerHTML = traitsHtml;
            
            // Description
            document.getElementById('description').textContent = personality.description;
            
            // Compatibility - simplified to just snack names
            const compatHtml = `
                <div class="compat-grid">
                    <div class="compat-group">
                        <h4 class="friends-title">Besties with üíö</h4>
                        <div class="compat-names">
                            ${personality.friends.map(friend => {
                                // Find the snack name for this personality type
                                const friendKey = Object.keys(personalityTypes).find(key => 
                                    personalityTypes[key].name === friend.type
                                );
                                const friendSnack = friendKey ? personalityTypes[friendKey].snack : friend.type;
                                return `<div class="compat-name friends-name">${friendSnack}</div>`;
                            }).join('')}
                        </div>
                    </div>
                    <div class="compat-group">
                        <h4 class="strangers-title">Doesn't vibe with üíî</h4>
                        <div class="compat-names">
                            ${personality.strangers.map(stranger => {
                                // Find the snack name for this personality type
                                const strangerKey = Object.keys(personalityTypes).find(key => 
                                    personalityTypes[key].name === stranger.type
                                );
                                const strangerSnack = strangerKey ? personalityTypes[strangerKey].snack : stranger.type;
                                return `<div class="compat-name strangers-name">${strangerSnack}</div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('compatibility').innerHTML = compatHtml;
            
            document.getElementById('results').classList.add('active');
        }

        function toggleOtherTypes() {
            const section = document.getElementById('otherTypes');
            const resultGrid = document.querySelector('.result-grid');
            const resultHeader = document.querySelector('.result-header');
            const exploreBtn = document.querySelector('.explore-btn');
            const isActive = section.classList.contains('active');
            
            if (isActive) {
                // Show main results, hide other types
                section.classList.remove('active');
                resultGrid.style.display = 'grid';
                resultHeader.style.display = 'block';
                exploreBtn.textContent = '‚ú® Explore Other Personality Types';
            } else {
                // Hide main results, show other types
                // Generate content if not already generated
                if (!section.innerHTML) {
                    generateOtherTypesContent();
                }
                section.classList.add('active');
                resultGrid.style.display = 'none';
                resultHeader.style.display = 'none';
                exploreBtn.textContent = '‚Üê Back to Your Results';
            }
        }

        function generateOtherTypesContent() {
            const section = document.getElementById('otherTypes');
            
            // Get current user's personality type
            let maxScore = 0;
            let currentType = '';
            for (let type in scores) {
                if (scores[type] > maxScore) {
                    maxScore = scores[type];
                    currentType = type;
                }
            }
            
            let html = '';
            
            // Generate each cluster
            for (let clusterKey in personalityClusters) {
                const cluster = personalityClusters[clusterKey];
                
                html += `
                    <div class="cluster-group">
                        <div class="cluster-header ${clusterKey}">
                            <h3 class="cluster-title">${cluster.name}</h3>
                            <p class="cluster-description">${cluster.description}</p>
                        </div>
                        <div class="personality-cards">
                `;
                
                // Add personality cards for this cluster (3 personalities)
                cluster.types.forEach(typeKey => {
                    const personality = personalityTypes[typeKey];
                    const isUserType = typeKey === currentType;
                    
                    html += `
                        <div class="personality-card ${isUserType ? 'user-type' : ''}">
                            <img src="${personality.image}" 
                                 alt="${personality.snack}" 
                                 class="personality-card-image"
                                 onerror="this.style.display='none';">
                            <p class="personality-card-snack">${personality.snack}</p>
                            <p class="personality-card-name">${personality.name}</p>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            section.innerHTML = html;
        }

        function restartQuiz() {
            currentQuestion = 0;
            answers = {}; // Reset answers
            scores = {
                harmonizer: 0,
                achiever: 0,
                nurturer: 0,
                innovator: 0,
                traditionalist: 0,
                adventurer: 0,
                analyst: 0,
                idealist: 0,
                entertainer: 0,
                protector: 0,
                individualist: 0,
                catalyst: 0
            };
            
            // Restore cream background and scrolling
            document.querySelector('.container').classList.remove('no-bg');
            document.body.classList.remove('quiz-mode');
            
            document.getElementById('results').classList.remove('active');
            document.getElementById('intro').style.display = 'block';
        }


        // Polyfill for roundRect if needed
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
            };
        }
    </script>
</body>
</html>